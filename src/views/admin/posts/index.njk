{% extends "admin/layout.njk" %} {% block content %}
<div
  class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
>
  <h1 class="h2">Manage Blog Posts</h1>
  <div class="btn-toolbar mb-2 mb-md-0">
    <a href="/admin/posts/new" class="btn btn-primary">
      <i class="bi bi-plus-circle"></i> New Post
    </a>
  </div>
</div>

<div class="row mb-3">
  <div class="col-md-6">
    <form action="/admin/posts" method="GET" class="d-flex">
      <input
        type="search"
        name="search"
        class="form-control me-2"
        placeholder="Search posts..."
        value="{{ searchQuery }}"
      />
      <button type="submit" class="btn btn-outline-secondary">
        <i class="bi bi-search"></i> Search
      </button>
    </form>
  </div>
</div>

{% if posts.length === 0 %}
<div class="alert alert-info">
  {% if searchQuery %} No posts found matching "{{ searchQuery }}". {% else %}
  No posts available. Create your first post! {% endif %}
</div>
{% else %}
<div class="table-responsive">
  <table class="table table-striped table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Author</th>
        <th>Created</th>
        <th>Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for post in posts %}
      <tr>
        <td>{{ post.id }}</td>
        <td>
          <strong>{{ post.title }}</strong>
          <br />
          <small class="text-muted">{{ post.excerpt | truncate(60) }}</small>
        </td>
        <td>{{ post.author }}</td>
        <td>{{ post.createdAt | date('MMM D, YYYY') }}</td>
        <td>{{ post.updatedAt | date('MMM D, YYYY') }}</td>
        <td>
          <div class="btn-group btn-group-sm" role="group">
            <a
              href="/posts/{{ post.slug }}"
              class="btn btn-outline-info"
              target="_blank"
              title="View"
            >
              <i class="bi bi-eye"></i>
            </a>
            <a
              href="/admin/posts/{{ post.id }}/edit"
              class="btn btn-outline-primary"
              title="Edit"
            >
              <i class="bi bi-pencil"></i>
            </a>
            <form
              action="/admin/posts/{{ post.id }}/delete"
              method="POST"
              style="display: inline"
              onsubmit="return confirm('Are you sure you want to delete this post?');"
            >
              <button
                type="submit"
                class="btn btn-outline-danger btn-sm"
                title="Delete"
              >
                <i class="bi bi-trash"></i>
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if totalPages > 1 %}
<nav aria-label="Admin posts pagination" class="mt-4">
  <ul class="pagination">
    <li class="page-item {% if not hasPrevious %}disabled{% endif %}">
      <a
        class="page-link"
        href="/admin/posts?page={{
          currentPage - 1
        }}{% if searchQuery %}&search={{ searchQuery }}{% endif %}"
        {%
        if
        not
        hasPrevious
        %}tabindex="-1"
        {%
        endif
        %}
      >
        Previous
      </a>
    </li>

    {% for pageNum in range(1, totalPages + 1) %}
    <li class="page-item {% if pageNum === currentPage %}active{% endif %}">
      <a
        class="page-link"
        href="/admin/posts?page={{ pageNum }}{% if searchQuery %}&search={{
          searchQuery
        }}{% endif %}"
        >{{ pageNum }}</a
      >
    </li>
    {% endfor %}

    <li class="page-item {% if not hasNext %}disabled{% endif %}">
      <a
        class="page-link"
        href="/admin/posts?page={{
          currentPage + 1
        }}{% if searchQuery %}&search={{ searchQuery }}{% endif %}"
        {%
        if
        not
        hasNext
        %}tabindex="-1"
        {%
        endif
        %}
      >
        Next
      </a>
    </li>
  </ul>
</nav>
{% endif %} {% endif %} {% endblock %}
